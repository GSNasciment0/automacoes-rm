/*Automa√ß√£o de Cadastro V18 - RM Rastreamento*/
(function(){if(document.getElementById("gm-automacao-panel")){return void alert("O painel de automa√ß√£o j√° est√° aberto.")}const e="#gm-automacao-panel{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:500px;max-width:90%;background:#f9f9f9;border:1px solid #ccc;border-radius:8px;z-index:10000;box-shadow:0 5px 15px rgba(0,0,0,.3);font-family:Arial,sans-serif}#gm-automacao-panel *{font-family:Arial,sans-serif}.gm-panel-header{display:flex;justify-content:space-between;align-items:center;padding:10px 15px;background:#f1f1f1;border-bottom:1px solid #ccc;border-radius:8px 8px 0 0}.gm-panel-header h3{margin:0;font-size:16px}#gm-close-automacao-btn{background:transparent;border:none;font-size:18px;font-weight:bold;cursor:pointer;color:#888}#gm-close-automacao-btn:hover{color:#333}.gm-panel-content{padding:15px;display:flex;flex-direction:column;gap:10px}.gm-panel-content label{font-weight:bold;font-size:14px}#gm-pdf-data-input{width:98%;padding:5px;border:1px solid #ddd;border-radius:4px;font-size:13px;resize:vertical}#gm-executar-automacao-btn{background-color:#28a745;color:#fff;border:none;border-radius:4px;padding:10px;font-size:15px;font-weight:bold;cursor:pointer}#gm-executar-automacao-btn:hover{background-color:#218838}.gm-log-section h4{margin:0 0 5px 0;font-size:14px}#gm-log-output{background:#fff;border:1px solid #eee;border-radius:4px;padding:10px;height:100px;overflow-y:auto;font-size:12px;font-family:'Courier New',Courier,monospace;color:#333}.gm-log-error{color:#d9534f;font-weight:bold}.gm-log-success{color:#5cb85c;font-weight:bold}.gm-checkbox-group{display:flex;align-items:center;gap:10px;background:#fff;padding:10px;border:1px solid #ddd;border-radius:4px}",t=document.createElement("style");t.type="text/css",t.id="gm-automacao-style",t.appendChild(document.createTextNode(e)),document.head.appendChild(t);const o=document.createElement("div");o.setAttribute("id","gm-automacao-panel"),o.innerHTML='<div class="gm-panel-header"><h3>ü§ñ Automa√ß√£o de Cadastro (V18)</h3><button id="gm-close-automacao-btn" title="Fechar">X</button></div><div class="gm-panel-content"><div class="gm-checkbox-group"><input type="checkbox" id="gm-is-ileva-checkbox" style="width:20px;height:20px;"><label for="gm-is-ileva-checkbox" style="font-weight:bold;margin-bottom:0;">Cliente pertence √† ILEVA (Marque, se for o caso)</label></div><label for="gm-pdf-data-input">Cole o texto do PDF aqui:</label><textarea id="gm-pdf-data-input" rows="10" placeholder="Cole o texto copiado aqui."></textarea><button id="gm-executar-automacao-btn">Preencher Formul√°rio</button><hr><div class="gm-log-section"><h4>üìú Log de Execu√ß√£o</h4><div id="gm-log-output"></div></div></div>',document.body.appendChild(o);const n=o.querySelector("#gm-log-output"),l=(e,t="info")=>{const o=document.createElement("div");o.textContent=`[${(new Date).toLocaleTimeString()}] ${e}`,"error"===t?o.className="gm-log-error":"success"===t&&(o.className="gm-log-success"),n.appendChild(o),n.scrollTop=n.scrollHeight},i=e=>{const t=(e||"").replace(/[^\d]/g,"");return t.startsWith("55")?t.substring(2):t},a=e=>{l("Iniciando extra√ß√£o de dados...");let t={},o="";try{const n=t=>{const o=(e.match(t)||[])[1]?.trim();return o?.replace(/\n/g," ")?.trim()||null};if(e.includes("Nome/Raz√£o Social:")){l("Detectado Formato 1 (PDF)."),o="PDF";const a=n(/Nome\/Raz√£o Social:\s*(.*?)\n/),r=n(/CPF\/CNPJ:\s*(.*?)(?:\s*RG:|\n)/),c=n(/RG:\s*(.*?)(?:\s*CNH:|\n)/),d=n(/E-mail:\s*(.*?)(?:\s*Nasc\.:|\n)/),s=n(/Nasc\.:\s*(.*?)\n/),u=n(/Celular:\s*(.*?)(?:\s*Telefone:|\n)/),p=n(/Telefone:\s*(.*?)\n/),m=n(/CEP:\s*(.*?)\n/),g=n(/N√∫mero:\s*(.*?)\n/);t={nome:a,cpf:r,rg:c,email:d,nascimento:s,celular1:u,celular2:p,cep:m,numero:g}}else if(e.includes("Nome Completo\n")&&e.includes("Celular WhatsApp:")){l("Detectado Formato 3 (Novo ILEVA)."),o="Novo ILEVA";const a=n(/Nome Completo\s*\n(.*?)\n/),r=n(/CPF:\s*\n(.*?)\n/),c=n(/RG:\s*\n(.*?)\n/),d=n(/E-mail:\s*\n(.*?)\n/),s=n(/Data Nasc.:\s*\n(.*?)\n/),u=n(/Celular WhatsApp:\s*\n(.*?)\n/),p=n(/Telefone fixo:\s*\n(.*?)\n/)||n(/Celular Recado:\s*\n(.*?)\n/);const m=n(/CEP:\s*\n(.*?)\n/),g=n(/N√∫mero:\s*\n(.*?)\n/);t={nome:a,cpf:r,rg:c,email:d,nascimento:s,celular1:u,celular2:p,cep:m,numero:g}}else if(e.includes("Nome:")||e.includes("Telefone / Whatsapp")){l("Detectado Formato 2 (Portal Antigo)."),o="Portal Antigo";const a=n(/Nome:\s*\n(.*?)\n/),r=n(/CPF\/CNPJ:\s*\n(.*?)\n/),c=n(/^RG:\s*\n(.*?)\n/m),d=n(/E-mail:\s*\n(.*?)\n/),s=n(/Dt nascimento:\s*\n(.*?)\n/),u=n(/Telefone \/ Whatsapp\s*\n(.*?)\n/),p=n(/Telefone 2:\s*\n(.*?)\n/);const m=n(/CEP:\s*\n(.*?)\n/),g=n(/N√∫mero:\s*\n(.*?)\n/);t={nome:a,cpf:r,rg:c,email:d,nascimento:s,celular1:u,celular2:p,cep:m,numero:g}}else return l("Erro: Formato de texto n√£o reconhecido.","error"),null;if(!t.nome||!t.cpf)return l(`Falha ao extrair dados essenciais (Nome ou CPF) do formato ${o}.`,"error"),null;const h={nome:(t.nome||"").toUpperCase(),cpf:(t.cpf||"").replace(/[^\d]/g,""),rg:t.rg||"",email:t.email||"",nascimento:t.nascimento||"",celular1:i(t.celular1),celular2:i(t.celular2),cep:(t.cep||"").replace(/[^\d]/g,""),numero:t.numero||""};return l("Dados extra√≠dos com sucesso.","success"),h}catch(e){return l(`Erro inesperado durante a extra√ß√£o: ${e.message}`,"error"),null}},r=(e,t)=>{l("Iniciando preenchimento do formul√°rio...");try{const o=(e,t,o)=>{if(t){const n=document.getElementById(e);n?(n.value=t,n.dispatchEvent(new Event("change"))):(l(`Erro: Campo ${o} (ID: ${e}) n√£o encontrado.`,"error"),console.error(`Campo ${o} (ID: ${e}) n√£o encontrado.`))}else l(`Info: Nenhum valor encontrado para ${o}.`,"info")};o("id_form_pessoa-nome_razao_social",e.nome,"Nome/Raz√£o Social"),o("id_form_pessoa-apelido_fantasia",e.nome,"Nome Fantasia"),o("id_form_pessoa-cnpj_cpf",e.cpf,"CNPJ/CPF"),o("id_form_pessoa-rg",e.rg,"RG"),o("id_form_pessoa-email",e.email,"Email"),o("id_form_pessoa-dt_bertura_nasc",e.nascimento,"Data Nascimento"),o("id_form_pessoa-categoria",t,"Categoria (Valor Selecionado)"),o("id_form_endereco-cep",e.cep,"CEP"),o("id_form_endereco-numero",e.numero,"N√∫mero Resid√™ncia");if(e.cep){const n=document.getElementById("id_form_endereco-cep");if(n){n.dispatchEvent(new Event("blur",{bubbles:!0})),l("OK: Evento 'blur' for√ßado no CEP para iniciar busca do endere√ßo.","success");const t=document.getElementById("id_form_endereco-logradouro");t&&t.focus()}l("Aten√ß√£o: Para o preenchimento completo do Endere√ßo, mude para a aba 'Endere√ßo'.","info")}if(e.celular1||e.celular2){const t=[{num:e.celular1,is_whatsapp:!0},{num:e.celular2,is_whatsapp:!1}].filter(e=>e.num&&e.num.length>0);for(let e=0;e<t.length;e++){const o=t[e],n=document.querySelector(`div.item${e} input[name="form_fone-numero"]`);if(n){n.value=o.num,n.dispatchEvent(new Event("change",{bubbles:!0})),l(`OK: Telefone ${e+1} (${o.num}) preenchido.`);const t=document.querySelector(`div.item${e} input[name="form_fone-whatsapp-0"]`);0===e&&o.is_whatsapp&&t?(t.checked=!0,t.dispatchEvent(new Event("change",{bubbles:!0})),l(`OK: Checkbox WhatsApp (Telefone ${e+1}) marcado (Celular 1).`)):l(`Info: Checkbox WhatsApp (Telefone ${e+1}) ignorado/n√£o encontrado.`)}else l(`Info: Campo de Telefone ${e+1} (div.item${e}) n√£o encontrado.`)}l("Preenchimento dos n√∫meros de telefone conclu√≠do.")}else l("Info: Nenhum n√∫mero de telefone encontrado.","info");l("Preenchimento do formul√°rio conclu√≠do!","success")}catch(e){l(`Erro inesperado ao preencher: ${e.message}`,"error")}};o.querySelector("#gm-close-automacao-btn").addEventListener("click",()=>{document.body.removeChild(o),document.head.removeChild(document.getElementById("gm-automacao-style"))}),o.querySelector("#gm-executar-automacao-btn").addEventListener("click",()=>{n.innerHTML="",l("Iniciando script...");const e=o.querySelector("#gm-is-ileva-checkbox").checked?"34":"6";const t=o.querySelector("#gm-pdf-data-input").value;if(!t)return void l("O campo de texto do PDF est√° vazio. Cole os dados primeiro.","error");const c=a(t);c?r(c,e):l("A automa√ß√£o falhou. Verifique os logs e o texto colado.","error")})})();
