/*Automa√ß√£o de Ve√≠culos V2.2 - RM Rastreamento */
(async function(){if(document.getElementById("gm-veiculo-panel")){return void console.log("O painel de ve√≠culo j√° est√° aberto.")}const css=`#gm-veiculo-panel{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:500px;max-width:90%;background:#f9f9f9;border:2px solid #007bff;border-radius:8px;z-index:999999;box-shadow:0 5px 15px rgba(0,0,0,0.5);font-family:Arial,sans-serif}#gm-veiculo-panel *{font-family:Arial,sans-serif}.gm-header{display:flex;justify-content:space-between;align-items:center;padding:10px;background:#007bff;color:white;border-radius:6px 6px 0 0;font-weight:bold}.gm-header button{background:none;border:none;color:white;font-size:16px;cursor:pointer}.gm-content{padding:15px;display:flex;flex-direction:column;gap:10px}textarea{width:98%;height:100px;padding:8px;border:1px solid #ccc;border-radius:4px;resize:vertical}.gm-actions{display:flex;gap:10px;align-items:stretch}.gm-actions button{border:none;padding:10px;font-size:14px;font-weight:bold;border-radius:4px;cursor:pointer;flex-grow:1;transition:background-color 0.2s}#gm-btn-paste{background:#ffc107;color:#333;width:40px;height:40px;flex-grow:0;display:flex;align-items:center;justify-content:center}#gm-btn-paste:hover{background:#e0a800}#gm-btn-preencher{background:#17a2b8;color:white}#gm-btn-preencher:hover{background:#138496}#gm-log{background:#fff;border:1px solid #ddd;padding:5px;height:80px;overflow-y:auto;font-size:11px;color:#333}.log-success{color:green;font-weight:bold}.log-error{color:red;font-weight:bold}`;const style=document.createElement("style");style.appendChild(document.createTextNode(css));document.head.appendChild(style);const panel=document.createElement("div");panel.id="gm-veiculo-panel";panel.innerHTML=`<div class="gm-header"><span>üöó Automa√ß√£o de Ve√≠culo (V22)</span><button id="gm-btn-close">X</button></div><div class="gm-content"><textarea id="gm-text-input" placeholder="Cole o texto do contrato aqui..."></textarea><div class="gm-actions"><button id="gm-btn-paste" title="Colar da √Årea de Transfer√™ncia"><svg style="width:20px;height:20px;display:block;margin:0 auto;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="10" y="4" width="4" height="4" rx="1"/><path d="M14 2c2.2 0 4 1.8 4 4v14c0 1.1-.9 2-2 2H8c-1.1 0-2-.9-2-2V6c0-2.2 1.8-4 4-4z"/></svg></button><button id="gm-btn-preencher">Preencher Ve√≠culo</button></div><div id="gm-log"></div></div>`;document.body.appendChild(panel);const logArea=panel.querySelector("#gm-log");const input=panel.querySelector("#gm-text-input");const log=(msg,type="info")=>{const div=document.createElement("div");div.textContent=`[${new Date().toLocaleTimeString()}] ${msg}`;if(type==="success")div.className="log-success";if(type==="error")div.className="log-error";logArea.appendChild(div);logArea.scrollTop=logArea.scrollHeight};const handlePaste=async()=>{try{const text=await navigator.clipboard.readText();input.value=text;log("OK: Texto colado da √°rea de transfer√™ncia.","success")}catch(err){log("Erro ao acessar clipboard. Cole manualmente o texto no campo.","error")}};const setField=(id,value,label)=>{if(!value)return log(`Info: Sem valor para ${label}.`,"info");const el=document.getElementById(id)||document.getElementsByName(id)[0];if(el){el.focus();try{let prototype=Object.getPrototypeOf(el);let prototypeValueSetter=Object.getOwnPropertyDescriptor(prototype,"value").set;prototypeValueSetter.call(el,value)}catch(e){el.value=value}el.dispatchEvent(new Event('input',{bubbles:true}));el.dispatchEvent(new Event('change',{bubbles:true}));el.dispatchEvent(new Event('blur',{bubbles:true}));log(`OK: ${label} preenchido.`,"success")}else{log(`Erro: Campo ${label} (${id}) n√£o encontrado!`,"error")}};const clickNoButton=()=>{const onButton=document.querySelector(".bootstrap-switch-handle-on");if(onButton&&onButton.textContent.trim()==="Sim"){onButton.click();log("OK: Chave de Rastreador desligada.","success")}else{log("Aviso: Bot√£o 'Sim' da chave de Rastreador n√£o encontrado ou j√° est√° 'N√£o'.","info")}};const run=()=>{logArea.innerHTML="";const text=input.value;if(!text)return log("Erro: Cole o texto do contrato!","error");log("Iniciando extra√ß√£o...");const cleanText=text.replace(/\r\n/g,"\n").replace(/\r/g,"\n").replace(/ {2,}/g," ").trim();const getVal=(regex)=>(cleanText.match(regex)||[])[1]?.trim()||null;let placa=getVal(/Placa:\s*([^\n]*?)(?:\s*C√≥d|\s*Valor|\n)/i);let chassi=getVal(/(?:Chassi|N¬∫ Chassi):\s*([^\n]*?)(\s*Tipo|\s*Renava|\n)/i);let renavam=getVal(/Renava[nm]:\s*([^\n]*?)(?:\s*Tipo|\s*Cota|\n)/i);let cor=getVal(/Cor:\s*([^\n]*?)(?:\s*Placa|\s*Possui|\n)/i);let anoFabricacao=getVal(/(?:Ano\/Modelo|Ano Fabrica√ß√£o):\s*(\d{4})/i);let anoModelo=getVal(/Ano\/Modelo:\s*(\d{4})/i);let marca=getVal(/Marca:\s*([^\n]*?)(?:\s*Modelo:|\s*Ano|\n)/i);let modelo=getVal(/(?<!Ano\s)Modelo:\s*([^\n]*?)(?:\s*Cor:|\s*C√≥d|Ano\/|\s*Placa:|\n|$)/i);if(placa)placa=placa.replace(/[^a-zA-Z0-9]/g,"").toUpperCase();if(marca)marca=marca.replace(/Modelo:.*|Cor:.*|Placa:.*|Ano\/.*/i,"").trim();if(modelo)modelo=modelo.replace(/Cor:.*|C√≥d.*|Ano\/.*/i,"").trim();log(`Dados extra√≠dos: Placa ${placa||"?"}, Renavam ${renavam||"?"}`);log(`Modelo: ${modelo||"?"}`);clickNoButton();setField("id_placa",placa,"Placa");setField("id_chassi",chassi,"Chassi");setField("id_renavam",renavam,"Renavam");setField("id_ano_fabricacao",anoFabricacao,"Ano Fabrica√ß√£o");setField("id_cor",cor,"Cor");setField("id_marca",marca,"Marca");setField("id_modelo",modelo,"Modelo");setField("id_ano",anoModelo||anoFabricacao,"Ano do Modelo (id_ano)");log("Processo finalizado.","success")};panel.querySelector("#gm-btn-close").onclick=()=>panel.remove();panel.querySelector("#gm-btn-preencher").onclick=run;panel.querySelector("#gm-btn-paste").onclick=handlePaste;})();
